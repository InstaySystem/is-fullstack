services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: app_backend
    restart: unless-stopped
    environment:
      PG_HOST: ${PG_HOST:-localhost}
      PG_PORT: ${PG_PORT:-5432}
      PG_USER: ${PG_USER:-postgres}
      PG_PASSWORD: ${PG_PASSWORD:-postgres}
      PG_SSL_MODE: ${PG_SSL_MODE:-disable}
      PG_DB_NAME: ${PG_DB_NAME:-app_db}

      RD_HOST: ${RD_HOST}
      RD_PORT: ${RD_PORT:-6379}
      RD_PASSWORD: ${RD_PASSWORD:-redis123}

      RMQ_HOST: ${RMQ_HOST}
      RMQ_USER: ${RMQ_USER:-rabbitmq}
      RMQ_PASSWORD: ${RMQ_PASSWORD:-rabbitmq}
      RMQ_VHOST: ${RMQ_VHOST:-/}

      S3_BUCKET: ${S3_BUCKET}
      S3_FOLDER: ${S3_FOLDER}
      S3_ACCESS_KEY_ID: ${S3_ACCESS_KEY_ID}
      S3_SECRET_ACCESS_KEY: ${S3_SECRET_ACCESS_KEY}
      S3_REGION: ${S3_REGION:-us-east-1}

      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT:-587}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASSWORD: ${SMTP_PASSWORD}

      IMAP_HOST: ${IMAP_HOST}
      IMAP_PORT: ${IMAP_PORT:-993}
      IMAP_USER: ${IMAP_USER}
      IMAP_PASSWORD: ${IMAP_PASSWORD}

      JWT_ACCESS_NAME: ${JWT_ACCESS_NAME:-access_token}
      JWT_REFRESH_NAME: ${JWT_REFRESH_NAME:-refresh_token}
      JWT_GUEST_NAME: ${JWT_GUEST_NAME:-guest_token}
      JWT_SECRET_KEY: ${JWT_SECRET_KEY:-your-secret-key-change-this}
      JWT_ACCESS_EXPIRES_IN: ${JWT_ACCESS_EXPIRES_IN:-15m}
      JWT_REFRESH_EXPIRES_IN: ${JWT_REFRESH_EXPIRES_IN:-168h}

      SV_API_PREFIX: ${SV_API_PREFIX:-/api/v1}
      SV_PORT: 8080
      SV_WRITE_TIMEOUT: ${SV_WRITE_TIMEOUT:-15s}
      SV_READ_TIMEOUT: ${SV_READ_TIMEOUT:-15s}
      SV_IDLE_TIMEOUT: ${SV_IDLE_TIMEOUT:-60s}
      SV_ALLOW_ORIGINS: ${SV_ALLOW_ORIGINS:-http://localhost:3000}
      SV_ALLOW_METHODS: ${SV_ALLOW_METHODS:-GET,POST,PUT,DELETE,PATCH,OPTIONS}
      SV_ALLOW_HEADERS: ${SV_ALLOW_HEADERS:-Origin,Content-Type,Accept,Authorization}
      SV_EXPOSE_HEADERS: ${SV_EXPOSE_HEADERS:-Content-Length}
      SV_ALLOW_CREDENTIALS: ${SV_ALLOW_CREDENTIALS:-true}
      SV_MAX_AGE: ${SV_MAX_AGE:-12h}
      SV_MAX_HEADER_BYTES: ${SV_MAX_HEADER_BYTES:-5}
    ports:
      - "${BACKEND_PORT:-8080}:8080"
    volumes:
      - ./backend/logs:/app/logs
    networks:
      - app_network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:8080/api/v1}
    container_name: app_frontend
    restart: unless-stopped
    environment:
      NODE_ENV: production
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:8080/api/v1}
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
    depends_on:
      - backend
    networks:
      - app_network

networks:
  app_network:
    driver: bridge